<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Tutor AI - Profesor de Inglés por Voz</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --secondary: #3a0ca3;
            --accent: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --success: #4cc9f0;
            --error: #ef233c;
            --correction: #2ec4b6;
            --shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 15px 40px rgba(0, 0, 0, 0.12);
            --radius: 12px;
            --radius-lg: 20px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 28px;
            color: var(--primary);
        }

        .logo h1 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 24px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .settings-btn {
            background: white;
            border: none;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 20px;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .settings-btn:hover {
            transform: rotate(30deg);
            background: var(--primary);
            color: white;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .chat-container {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 600px;
        }

        .chat-header {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .bot-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        .bot-info h2 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 22px;
            margin-bottom: 5px;
        }

        .bot-info p {
            font-size: 14px;
            opacity: 0.9;
        }

        .chat-messages {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
            background-color: #f9fafc;
        }

        .message {
            max-width: 80%;
            padding: 18px;
            border-radius: var(--radius);
            position: relative;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            align-self: flex-end;
            background-color: var(--primary);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .bot-message {
            align-self: flex-start;
            background-color: white;
            border: 1px solid var(--light-gray);
            border-bottom-left-radius: 5px;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .message-sender {
            font-weight: 600;
            font-size: 14px;
        }

        .message-time {
            font-size: 12px;
            opacity: 0.7;
        }

        .message-content {
            line-height: 1.5;
        }

        .error-text {
            color: var(--error);
            text-decoration: line-through;
            font-weight: 500;
        }

        .correction-text {
            color: var(--correction);
            font-weight: 600;
        }

        .translation-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            color: var(--gray);
            font-size: 14px;
            cursor: pointer;
            transition: color 0.2s;
        }

        .translation-icon:hover {
            color: var(--primary);
        }

        .voice-controls {
            background: white;
            padding: 25px;
            border-top: 1px solid var(--light-gray);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .voice-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(to right, var(--primary), var(--primary-light));
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.4);
            transition: all 0.3s ease;
            position: relative;
        }

        .voice-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(67, 97, 238, 0.5);
        }

        .voice-btn.listening {
            background: linear-gradient(to right, var(--accent), #ff4d6d);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 35, 60, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(239, 35, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 35, 60, 0); }
        }

        .sound-wave {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            height: 40px;
            margin-bottom: 10px;
        }

        .wave-bar {
            width: 4px;
            height: 20px;
            background-color: var(--primary);
            border-radius: 3px;
            animation: soundWave 1.2s ease infinite;
            opacity: 0.7;
        }

        .wave-bar:nth-child(2) { animation-delay: 0.1s; }
        .wave-bar:nth-child(3) { animation-delay: 0.2s; }
        .wave-bar:nth-child(4) { animation-delay: 0.3s; }
        .wave-bar:nth-child(5) { animation-delay: 0.4s; }

        @keyframes soundWave {
            0%, 100% { height: 20px; }
            50% { height: 40px; }
        }

        .voice-status {
            font-size: 16px;
            font-weight: 500;
            color: var(--dark);
            text-align: center;
        }

        .instruction {
            text-align: center;
            color: var(--gray);
            font-size: 14px;
            max-width: 600px;
            margin: 0 auto;
        }

        .settings-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 500px;
            padding: 30px;
            box-shadow: var(--shadow-lg);
            animation: modalFade 0.3s ease;
        }

        @keyframes modalFade {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-header h2 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            color: var(--dark);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--gray);
            cursor: pointer;
            transition: color 0.2s;
        }

        .close-modal:hover {
            color: var(--error);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .api-input {
            width: 100%;
            padding: 14px;
            border: 1px solid var(--light-gray);
            border-radius: var(--radius);
            font-family: 'Inter', sans-serif;
            font-size: 16px;
            transition: border 0.3s;
        }

        .api-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .api-help {
            font-size: 14px;
            color: var(--gray);
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .api-help a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }

        .api-help a:hover {
            text-decoration: underline;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 24px;
            border-radius: var(--radius);
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary);
        }

        .btn-secondary {
            background: var(--light-gray);
            color: var(--dark);
        }

        .btn-secondary:hover {
            background: #d8d8d8;
        }

        .notification {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: var(--radius);
            background: white;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1001;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translate(-50%, 20px); }
            to { opacity: 1; transform: translate(-50%, 0); }
        }

        .notification.hidden {
            display: none;
        }

        .notification.success {
            border-left: 4px solid var(--correction);
        }

        .notification.error {
            border-left: 4px solid var(--error);
        }

        footer {
            text-align: center;
            margin-top: 40px;
            color: var(--gray);
            font-size: 14px;
            padding: 20px 0;
        }

        @media (max-width: 768px) {
            .chat-container {
                height: 500px;
            }
            
            .message {
                max-width: 90%;
            }
            
            .logo h1 {
                font-size: 20px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 15px;
            }
            
            .chat-header {
                padding: 15px;
            }
            
            .bot-avatar {
                width: 50px;
                height: 50px;
            }
            
            .bot-info h2 {
                font-size: 18px;
            }
            
            .voice-btn {
                width: 60px;
                height: 60px;
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
                <h1>English Tutor AI</h1>
            </div>
            <button class="settings-btn" id="settingsBtn">
                <i class="fas fa-cog"></i>
            </button>
        </header>

        <main class="main-content">
            <div class="chat-container">
                <div class="chat-header">
                    <img src="https://images.unsplash.com/photo-1568602471122-7832951cc4c5?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=300&q=80" alt="Profesor de inglés" class="bot-avatar">
                    <div class="bot-info">
                        <h2>Profesor Alex</h2>
                        <p>Tu tutor personal de inglés • En línea</p>
                    </div>
                </div>

                <div class="chat-messages" id="chatMessages">
                    <div class="message bot-message">
                        <div class="message-header">
                            <span class="message-sender">Profesor Alex</span>
                            <span class="message-time">12:00 PM</span>
                        </div>
                        <div class="message-content">
                            ¡Hola! Soy tu profesor de inglés personal. Habla conmigo en inglés y te ayudaré a corregir tus errores. Pulsa el botón de micrófono para comenzar a hablar.
                        </div>
                        <div class="translation-icon" title="Traducir">
                            <i class="fas fa-language"></i>
                        </div>
                    </div>
                </div>

                <div class="voice-controls">
                    <div class="sound-wave" id="soundWave">
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                    </div>
                    
                    <button class="voice-btn" id="voiceBtn">
                        <i class="fas fa-microphone"></i>
                    </button>
                    
                    <div class="voice-status" id="voiceStatus">
                        Pulsa para hablar con tu profesor
                    </div>
                    
                    <p class="instruction">
                        Habla en inglés sobre cualquier tema. Tu profesor señalará los errores <span class="error-text">en rojo</span> y mostrará las correcciones <span class="correction-text">en verde</span>.
                    </p>
                </div>
            </div>
        </main>

        <footer>
            <p>English Tutor AI &copy; 2023 • Usa tu propia API key de Gemini para mayor privacidad</p>
        </footer>
    </div>

    <!-- Modal de configuración -->
    <div class="settings-modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Configuración de API</h2>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            
            <div class="form-group">
                <label for="apiKey">Clave API de Gemini</label>
                <input type="password" id="apiKey" class="api-input" placeholder="Ingresa tu clave API de Google AI Studio">
                <p class="api-help">
                    <i class="fas fa-info-circle"></i>
                    Obtén tu clave API gratuita en 
                    <a href="https://makersuite.google.com/app/apikey" target="_blank">Google AI Studio</a>
                </p>
            </div>
            
            <div class="form-group">
                <label for="botName">Nombre del profesor</label>
                <input type="text" id="botName" class="api-input" placeholder="Alex" value="Alex">
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" id="clearChatBtn">Limpiar chat</button>
                <button class="btn btn-primary" id="saveSettingsBtn">Guardar configuración</button>
            </div>
        </div>
    </div>

    <!-- Notificación -->
    <div class="notification hidden" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Configuración guardada correctamente</span>
    </div>

    <script>
        // Elementos DOM
        const chatMessages = document.getElementById('chatMessages');
        const voiceBtn = document.getElementById('voiceBtn');
        const voiceStatus = document.getElementById('voiceStatus');
        const soundWave = document.getElementById('soundWave');
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsModal = document.getElementById('settingsModal');
        const closeModal = document.getElementById('closeModal');
        const apiKeyInput = document.getElementById('apiKey');
        const botNameInput = document.getElementById('botName');
        const saveSettingsBtn = document.getElementById('saveSettingsBtn');
        const clearChatBtn = document.getElementById('clearChatBtn');
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notificationText');

        // Variables de estado
        let isListening = false;
        let recognition = null;
        let apiKey = '';
        let botName = 'Profesor Alex';
        let conversationHistory = [];

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            initializeVoiceRecognition();
            setupEventListeners();
            soundWave.style.display = 'none';
            
            // Mensaje de bienvenida inicial
            addBotMessage("Hello! I'm your English tutor. You can start speaking in English about any topic, and I'll help you improve your grammar, vocabulary, and pronunciation. Let's begin!");
        });

        // Cargar configuración desde localStorage
        function loadSettings() {
            const savedApiKey = localStorage.getItem('englishTutorApiKey');
            const savedBotName = localStorage.getItem('englishTutorBotName');
            
            if (savedApiKey) {
                apiKey = savedApiKey;
                apiKeyInput.value = savedApiKey;
            }
            
            if (savedBotName) {
                botName = savedBotName;
                botNameInput.value = savedBotName;
            }
        }

        // Configurar event listeners
        function setupEventListeners() {
            voiceBtn.addEventListener('click', toggleVoiceRecognition);
            
            settingsBtn.addEventListener('click', () => {
                settingsModal.style.display = 'flex';
            });
            
            closeModal.addEventListener('click', () => {
                settingsModal.style.display = 'none';
            });
            
            saveSettingsBtn.addEventListener('click', saveSettings);
            
            clearChatBtn.addEventListener('click', clearChat);
            
            // Cerrar modal al hacer clic fuera de él
            window.addEventListener('click', (e) => {
                if (e.target === settingsModal) {
                    settingsModal.style.display = 'none';
                }
            });
            
            // Añadir funcionalidad a los íconos de traducción
            document.addEventListener('click', (e) => {
                if (e.target.closest('.translation-icon')) {
                    const messageElement = e.target.closest('.message');
                    const messageContent = messageElement.querySelector('.message-content').textContent;
                    translateMessage(messageContent);
                }
            });
        }

        // Inicializar reconocimiento de voz
        function initializeVoiceRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';
                
                recognition.onstart = () => {
                    isListening = true;
                    voiceBtn.classList.add('listening');
                    voiceStatus.textContent = 'Escuchando... habla ahora';
                    soundWave.style.display = 'flex';
                };
                
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    addUserMessage(transcript);
                    processUserInput(transcript);
                };
                
                recognition.onerror = (event) => {
                    console.error('Error en reconocimiento de voz:', event.error);
                    showNotification('Error en el reconocimiento de voz. Intenta de nuevo.', 'error');
                };
                
                recognition.onend = () => {
                    isListening = false;
                    voiceBtn.classList.remove('listening');
                    voiceStatus.textContent = 'Pulsa para hablar con tu profesor';
                    soundWave.style.display = 'none';
                };
            } else {
                voiceBtn.disabled = true;
                voiceStatus.textContent = 'Reconocimiento de voz no soportado en este navegador';
                showNotification('Tu navegador no soporta reconocimiento de voz. Prueba con Chrome o Edge.', 'error');
            }
        }

        // Alternar reconocimiento de voz
        function toggleVoiceRecognition() {
            if (!recognition) return;
            
            if (isListening) {
                recognition.stop();
            } else {
                try {
                    recognition.start();
                } catch (error) {
                    console.error('Error al iniciar reconocimiento:', error);
                }
            }
        }

        // Añadir mensaje del usuario al chat
        function addUserMessage(text) {
            const time = getCurrentTime();
            const messageElement = document.createElement('div');
            messageElement.className = 'message user-message';
            messageElement.innerHTML = `
                <div class="message-header">
                    <span class="message-sender">Tú</span>
                    <span class="message-time">${time}</span>
                </div>
                <div class="message-content">${text}</div>
                <div class="translation-icon" title="Traducir">
                    <i class="fas fa-language"></i>
                </div>
            `;
            
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Guardar en el historial
            conversationHistory.push({ role: 'user', content: text });
        }

        // Añadir mensaje del bot al chat
        function addBotMessage(text) {
            const time = getCurrentTime();
            const messageElement = document.createElement('div');
            
            // Procesar texto para encontrar errores y correcciones (simulado)
            const processedText = processTextForErrors(text);
            
            messageElement.className = 'message bot-message';
            messageElement.innerHTML = `
                <div class="message-header">
                    <span class="message-sender">${botName}</span>
                    <span class="message-time">${time}</span>
                </div>
                <div class="message-content">${processedText}</div>
                <div class="translation-icon" title="Traducir">
                    <i class="fas fa-language"></i>
                </div>
            `;
            
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Guardar en el historial
            conversationHistory.push({ role: 'assistant', content: text });
            
            // Sintetizar voz
            speakText(text);
        }

        // Procesar texto para mostrar errores y correcciones
        function processTextForErrors(text) {
            // Esta función simula la detección de errores
            // En una implementación real, usaríamos la API de Gemini para análisis gramatical
            
            // Simulación de detección de errores comunes
            const errorExamples = [
                { error: "I have 30 years old", correction: "I am 30 years old" },
                { error: "She don't like", correction: "She doesn't like" },
                { error: "I can to speak", correction: "I can speak" },
                { error: "I am agree", correction: "I agree" },
                { error: "more better", correction: "better" },
                { error: "the people is", correction: "people are" },
                { error: "I go to the school", correction: "I go to school" }
            ];
            
            let processedText = text;
            
            // Buscar ejemplos de errores en el texto
            errorExamples.forEach(example => {
                if (text.toLowerCase().includes(example.error.toLowerCase())) {
                    const errorRegex = new RegExp(example.error, 'gi');
                    processedText = processedText.replace(errorRegex, 
                        `<span class="error-text">${example.error}</span> → <span class="correction-text">${example.correction}</span>`);
                }
            });
            
            return processedText;
        }

        // Procesar la entrada del usuario
        async function processUserInput(text) {
            if (!apiKey) {
                addBotMessage("Please set up your Gemini API key first. Click the gear icon in the top right corner and enter your API key from Google AI Studio.");
                return;
            }
            
            addBotMessage("Processing your sentence...");
            
            try {
                // En una implementación real, aquí llamaríamos a la API de Gemini
                // Por ahora, simulamos una respuesta
                setTimeout(() => {
                    simulateGeminiResponse(text);
                }, 1500);
                
            } catch (error) {
                console.error('Error al procesar la entrada:', error);
                addBotMessage("I'm having trouble processing your request. Please check your API key and try again.");
            }
        }

        // Simular respuesta de Gemini
        function simulateGeminiResponse(userInput) {
            // Eliminar el mensaje "Processing..."
            chatMessages.removeChild(chatMessages.lastChild);
            conversationHistory.pop();
            
            // Respuestas simuladas basadas en la entrada del usuario
            let response = "";
            
            if (userInput.toLowerCase().includes("hello") || userInput.toLowerCase().includes("hi")) {
                response = "Hello! Nice to meet you. I notice you said 'hello' correctly. If you want to sound more natural, you can also say 'Hi there' or 'Hey'. How are you today?";
            } else if (userInput.toLowerCase().includes("how are you")) {
                response = "I'm doing well, thank you for asking! When asking 'How are you?', remember that the correct response is usually 'I'm fine, thank you' or 'I'm good, thanks'. You could also ask 'And you?' to continue the conversation.";
            } else if (userInput.toLowerCase().includes("my name is")) {
                response = "Nice to meet you! You introduced yourself correctly. Remember that in English we say 'My name is...' or more informally 'I'm...'. For example: <span class='error-text'>I am called John</span> → <span class='correction-text'>My name is John</span> or <span class='correction-text'>I'm John</span>.";
            } else if (userInput.toLowerCase().includes("i have") && userInput.toLowerCase().includes("years old")) {
                response = "Good try! But remember, in English we use 'to be' for age, not 'to have'. The correct way is: <span class='error-text'>I have 25 years old</span> → <span class='correction-text'>I am 25 years old</span> or <span class='correction-text'>I'm 25</span>.";
            } else if (userInput.toLowerCase().includes("she don't") || userInput.toLowerCase().includes("he don't")) {
                response = "Almost there! With 'he', 'she', or 'it', we use 'doesn't' instead of 'don't'. So: <span class='error-text'>She don't like coffee</span> → <span class='correction-text'>She doesn't like coffee</span>. For 'I', 'you', 'we', 'they' we use 'don't'.";
            } else {
                response = "Thanks for sharing! Your sentence structure is good. Remember to always use the correct verb form with the subject. For example: 'I go', 'he goes', 'they go'. Practice makes perfect! Try telling me about your daily routine.";
            }
            
            addBotMessage(response);
        }

        // Sintetizar voz
        function speakText(text) {
            if ('speechSynthesis' in window) {
                // Limpiar texto para voz (eliminar HTML)
                const cleanText = text.replace(/<[^>]*>/g, '');
                
                const utterance = new SpeechSynthesisUtterance(cleanText);
                utterance.lang = 'en-US';
                utterance.rate = 0.9;
                utterance.pitch = 1.0;
                utterance.volume = 1;
                
                // Seleccionar una voz en inglés si está disponible
                const voices = speechSynthesis.getVoices();
                const englishVoice = voices.find(voice => voice.lang.startsWith('en-'));
                if (englishVoice) utterance.voice = englishVoice;
                
                speechSynthesis.speak(utterance);
            }
        }

        // Traducir mensaje
        function translateMessage(text) {
            // En una implementación real, usaríamos una API de traducción
            // Por ahora, mostramos una notificación simulada
            showNotification('Traducción: La funcionalidad de traducción completa requeriría una API adicional.', 'info');
        }

        // Guardar configuración
        function saveSettings() {
            const newApiKey = apiKeyInput.value.trim();
            const newBotName = botNameInput.value.trim() || 'Profesor Alex';
            
            if (newApiKey) {
                apiKey = newApiKey;
                localStorage.setItem('englishTutorApiKey', newApiKey);
            }
            
            botName = newBotName;
            localStorage.setItem('englishTutorBotName', newBotName);
            
            // Actualizar nombre en los mensajes existentes
            document.querySelectorAll('.message-sender').forEach(element => {
                if (element.textContent === 'Profesor Alex' || element.textContent === botName) {
                    element.textContent = newBotName;
                }
            });
            
            settingsModal.style.display = 'none';
            showNotification('Configuración guardada correctamente', 'success');
            
            if (newApiKey) {
                addBotMessage(`Configuration updated! I'm ready to help you with your English practice. You can start speaking now.`);
            }
        }

        // Limpiar chat
        function clearChat() {
            chatMessages.innerHTML = '';
            conversationHistory = [];
            
            // Añadir mensaje inicial
            addBotMessage("Hello! I'm your English tutor. You can start speaking in English about any topic, and I'll help you improve your grammar, vocabulary, and pronunciation. Let's begin!");
            
            showNotification('Chat limpiado correctamente', 'success');
        }

        // Mostrar notificación
        function showNotification(message, type = 'info') {
            notificationText.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.remove('hidden');
            
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 3000);
        }

        // Obtener hora actual formateada
        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        // Cargar voces para síntesis de voz
        if ('speechSynthesis' in window) {
            speechSynthesis.onvoiceschanged = () => {
                // Voces cargadas
            };
        }
    </script>
</body>
</html>
